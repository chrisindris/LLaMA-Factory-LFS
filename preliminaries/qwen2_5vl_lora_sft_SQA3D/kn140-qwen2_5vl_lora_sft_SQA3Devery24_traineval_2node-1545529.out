created virtual environment CPython3.11.5.final.0-64 in 959ms
  creator CPython3Posix(dest=/tmp/ENV, clear=False, no_vcs_ignore=False, global=False)
  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/home/indrisch/.local/share/virtualenv)
    added seed packages: pip==25.3, setuptools==80.7.1, wheel==0.45.1+computecanada
  activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator
created virtual environment CPython3.11.5.final.0-64 in 875ms
  creator CPython3Posix(dest=/tmp/ENV, clear=False, no_vcs_ignore=False, global=False)
  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/home/indrisch/.local/share/virtualenv)
    added seed packages: pip==25.3, setuptools==80.7.1, wheel==0.45.1+computecanada
  activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Requirement already satisfied: pip in /tmp/ENV/lib/python3.11/site-packages (25.3)
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Requirement already satisfied: pip in /tmp/ENV/lib/python3.11/site-packages (25.3)
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/ray-2.49.1+computecanada-cp311-cp311-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/ray-2.49.1+computecanada-cp311-cp311-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/click-8.3.1+computecanada-py3-none-any.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/filelock-3.20.0+computecanada-py3-none-any.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/jsonschema-4.25.1+computecanada-py3-none-any.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/msgpack-1.1.2+computecanada-cp311-cp311-linux_x86_64.whl (from ray)
Requirement already satisfied: packaging in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v3/Compiler/gcccore/scipy-stack/2025a/lib/python3.11/site-packages (from ray) (24.2+computecanada)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3/protobuf-6.33.0+computecanada-cp311-cp311-linux_x86_64.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3/PyYAML-6.0.2+computecanada-cp311-cp311-linux_x86_64.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/requests-2.32.5+computecanada-py3-none-any.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/attrs-25.4.0+computecanada-py3-none-any.whl (from jsonschema->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/jsonschema_specifications-2025.9.1+computecanada-py3-none-any.whl (from jsonschema->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/referencing-0.37.0+computecanada-py3-none-any.whl (from jsonschema->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/click-8.3.1+computecanada-py3-none-any.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic/rpds_py-0.27.0+computecanada-cp311-cp311-linux_x86_64.whl (from jsonschema->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/filelock-3.20.0+computecanada-py3-none-any.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/jsonschema-4.25.1+computecanada-py3-none-any.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/msgpack-1.1.2+computecanada-cp311-cp311-linux_x86_64.whl (from ray)
Requirement already satisfied: typing-extensions>=4.4.0 in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v3/Compiler/gcccore/ipykernel/2025a/lib/python3.11/site-packages (from referencing>=0.28.4->jsonschema->ray) (4.12.2+computecanada)
Requirement already satisfied: packaging in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v3/Compiler/gcccore/scipy-stack/2025a/lib/python3.11/site-packages (from ray) (24.2+computecanada)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/charset_normalizer-3.4.4+computecanada-py3-none-any.whl (from requests->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/idna-3.11+computecanada-py3-none-any.whl (from requests->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3/protobuf-6.33.0+computecanada-cp311-cp311-linux_x86_64.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/urllib3-2.5.0+computecanada-py3-none-any.whl (from requests->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3/PyYAML-6.0.2+computecanada-cp311-cp311-linux_x86_64.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/requests-2.32.5+computecanada-py3-none-any.whl (from ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/certifi-2025.10.5+computecanada-py3-none-any.whl (from requests->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/attrs-25.4.0+computecanada-py3-none-any.whl (from jsonschema->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/jsonschema_specifications-2025.9.1+computecanada-py3-none-any.whl (from jsonschema->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/referencing-0.37.0+computecanada-py3-none-any.whl (from jsonschema->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic/rpds_py-0.27.0+computecanada-cp311-cp311-linux_x86_64.whl (from jsonschema->ray)
Requirement already satisfied: typing-extensions>=4.4.0 in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v3/Compiler/gcccore/ipykernel/2025a/lib/python3.11/site-packages (from referencing>=0.28.4->jsonschema->ray) (4.12.2+computecanada)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/charset_normalizer-3.4.4+computecanada-py3-none-any.whl (from requests->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/idna-3.11+computecanada-py3-none-any.whl (from requests->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/urllib3-2.5.0+computecanada-py3-none-any.whl (from requests->ray)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/certifi-2025.10.5+computecanada-py3-none-any.whl (from requests->ray)
Installing collected packages: urllib3, rpds-py, pyyaml, protobuf, msgpack, idna, filelock, click, charset-normalizer, certifi, attrs, requests, referencing, jsonschema-specifications, jsonschema, ray
Installing collected packages: urllib3, rpds-py, pyyaml, protobuf, msgpack, idna, filelock, click, charset-normalizer, certifi, attrs, requests, referencing, jsonschema-specifications, jsonschema, ray

Successfully installed attrs-25.4.0+computecanada certifi-2025.10.5+computecanada charset-normalizer-3.4.4+computecanada click-8.3.1+computecanada filelock-3.20.0+computecanada idna-3.11+computecanada jsonschema-4.25.1+computecanada jsonschema-specifications-2025.9.1+computecanada msgpack-1.1.2+computecanada protobuf-6.33.0+computecanada pyyaml-6.0.2+computecanada ray-2.49.1+computecanada referencing-0.37.0+computecanada requests-2.32.5+computecanada rpds-py-0.27.0+computecanada urllib3-2.5.0+computecanada

Successfully installed attrs-25.4.0+computecanada certifi-2025.10.5+computecanada charset-normalizer-3.4.4+computecanada click-8.3.1+computecanada filelock-3.20.0+computecanada idna-3.11+computecanada jsonschema-4.25.1+computecanada jsonschema-specifications-2025.9.1+computecanada msgpack-1.1.2+computecanada protobuf-6.33.0+computecanada pyyaml-6.0.2+computecanada ray-2.49.1+computecanada referencing-0.37.0+computecanada requests-2.32.5+computecanada rpds-py-0.27.0+computecanada urllib3-2.5.0+computecanada
Waiting for Ray cluster to initialize...
2025-12-04 17:35:06,971	INFO usage_lib.py:473 -- Usage stats collection is enabled by default without user confirmation because this terminal is detected to be non-interactive. To disable this, add `--disable-usage-stats` to the command that starts the cluster, or run the following command: `ray disable-usage-stats` before starting the cluster. See https://docs.ray.io/en/master/cluster/usage-stats.html for more details.
2025-12-04 17:35:06,972	INFO scripts.py:913 -- Local node IP: kn140
2025-12-04 17:35:08,218	SUCC scripts.py:949 -- --------------------
2025-12-04 17:35:08,219	SUCC scripts.py:950 -- Ray runtime started.
2025-12-04 17:35:08,219	SUCC scripts.py:951 -- --------------------
2025-12-04 17:35:08,219	INFO scripts.py:953 -- Next steps
2025-12-04 17:35:08,219	INFO scripts.py:956 -- To add another node to this Ray cluster, run
2025-12-04 17:35:08,219	INFO scripts.py:959 --   ray start --address='kn140:32789'
2025-12-04 17:35:08,219	INFO scripts.py:968 -- To connect to this Ray cluster:
2025-12-04 17:35:08,219	INFO scripts.py:970 -- import ray
2025-12-04 17:35:08,219	INFO scripts.py:971 -- ray.init(_node_ip_address='kn140')
2025-12-04 17:35:08,219	INFO scripts.py:1002 -- To terminate the Ray runtime, run
2025-12-04 17:35:08,219	INFO scripts.py:1003 --   ray stop
2025-12-04 17:35:08,219	INFO scripts.py:1006 -- To view the status of the cluster, use
2025-12-04 17:35:08,219	INFO scripts.py:1007 --   ray status
2025-12-04 17:35:08,219	INFO scripts.py:1123 -- --block
2025-12-04 17:35:08,219	INFO scripts.py:1124 -- This command will now block forever until terminated by a signal.
2025-12-04 17:35:08,219	INFO scripts.py:1127 -- Running subprocesses are monitored and a message will be printed if any of them terminate unexpectedly. Subprocesses exit with SIGTERM will be treated as graceful, thus NOT reported.
2025-12-04 17:35:07,053	INFO scripts.py:1094 -- Local node IP: 10.1.1.144
2025-12-04 17:35:09,390	SUCC scripts.py:1110 -- --------------------
2025-12-04 17:35:09,390	SUCC scripts.py:1111 -- Ray runtime started.
2025-12-04 17:35:09,390	SUCC scripts.py:1112 -- --------------------
2025-12-04 17:35:09,390	INFO scripts.py:1114 -- To terminate the Ray runtime, run
2025-12-04 17:35:09,390	INFO scripts.py:1115 --   ray stop
2025-12-04 17:35:09,390	INFO scripts.py:1123 -- --block
2025-12-04 17:35:09,390	INFO scripts.py:1124 -- This command will now block forever until terminated by a signal.
2025-12-04 17:35:09,390	INFO scripts.py:1127 -- Running subprocesses are monitored and a message will be printed if any of them terminate unexpectedly. Subprocesses exit with SIGTERM will be treated as graceful, thus NOT reported.
2025-12-04 17:35:11,674	INFO worker.py:1771 -- Connecting to existing Ray cluster at address: kn140:32789...
2025-12-04 17:35:11,688	INFO worker.py:1951 -- Connected to Ray cluster.
Ray cluster connected successfully
Available resources: {'object_store_memory': 323462949273.0, 'memory': 754746881639.0, 'CPU': 2.0, 'GPU': 2.0, 'node:10.1.1.144': 1.0, 'accelerator_type:L40S': 2.0, 'node:__internal_head__': 1.0, 'node:kn140': 1.0}

==========
== CUDA ==
==========

CUDA Version 12.4.1

Container image Copyright (c) 2016-2023, NVIDIA CORPORATION & AFFILIATES. All rights reserved.

This container image and its contents are governed by the NVIDIA Deep Learning Container License.
By pulling and using the container, you accept the terms and conditions of this license:
https://developer.nvidia.com/ngc/nvidia-deep-learning-container-license

A copy of this license is made available in this container at /NGC-DL-CONTAINER-LICENSE for your convenience.

[INFO|2025-12-04 17:35:29] llamafactory.launcher:143 >> Initializing 1 distributed tasks at: kn140:32789
[INFO|2025-12-04 17:35:29] llamafactory.launcher:143 >> Multi-node training enabled: num nodes: 2, node rank: 0
Traceback (most recent call last):
  File "/opt/conda/bin/torchrun", line 8, in <module>
    sys.exit(main())
             ^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 355, in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/run.py", line 918, in main
    run(args)
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/run.py", line 909, in run
    elastic_launch(
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/launcher/api.py", line 138, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/launcher/api.py", line 260, in launch_agent
    result = agent.run()
             ^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/metrics/api.py", line 137, in wrapper
    result = f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/agent/server/api.py", line 711, in run
    result = self._invoke_run(role)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/agent/server/api.py", line 864, in _invoke_run
    self._initialize_workers(self._worker_group)
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/metrics/api.py", line 137, in wrapper
    result = f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/agent/server/api.py", line 683, in _initialize_workers
    self._rendezvous(worker_group)
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/metrics/api.py", line 137, in wrapper
    result = f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/agent/server/api.py", line 500, in _rendezvous
    rdzv_info = spec.rdzv_handler.next_rendezvous()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/rendezvous/static_tcp_rendezvous.py", line 67, in next_rendezvous
    self._store = TCPStore(  # type: ignore[call-arg]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: The server socket has failed to listen on any local network address. port: 32789, useIpv6: 0, code: -98, name: EADDRINUSE, message: address already in use
Traceback (most recent call last):
  File "/opt/conda/bin/llamafactory-cli", line 7, in <module>
    sys.exit(main())
             ^^^^^^
  File "/app/src/llamafactory/cli.py", line 24, in main
    launcher.launch()
  File "/app/src/llamafactory/launcher.py", line 110, in launch
    process = subprocess.run(
              ^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['torchrun', '--nnodes', '2', '--node_rank', '0', '--nproc_per_node', '1', '--master_addr', 'kn140', '--master_port', '32789', '/app/src/llamafactory/launcher.py', '/project/aip-wangcs/indrisch/LLaMA-Factory/examples/train_lora/qwen2_5vl_lora_sft_SQA3Devery24_2node.yaml']' returned non-zero exit status 1.

==========
== CUDA ==
==========

CUDA Version 12.4.1

Container image Copyright (c) 2016-2023, NVIDIA CORPORATION & AFFILIATES. All rights reserved.

This container image and its contents are governed by the NVIDIA Deep Learning Container License.
By pulling and using the container, you accept the terms and conditions of this license:
https://developer.nvidia.com/ngc/nvidia-deep-learning-container-license

A copy of this license is made available in this container at /NGC-DL-CONTAINER-LICENSE for your convenience.

[INFO|2025-12-04 17:35:46] llamafactory.launcher:143 >> Initializing 1 distributed tasks at: kn140:32789
[INFO|2025-12-04 17:35:46] llamafactory.launcher:143 >> Multi-node training enabled: num nodes: 2, node rank: 1
Traceback (most recent call last):
  File "/opt/conda/bin/torchrun", line 8, in <module>
    sys.exit(main())
             ^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 355, in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/run.py", line 918, in main
    run(args)
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/run.py", line 909, in run
    elastic_launch(
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/launcher/api.py", line 138, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/launcher/api.py", line 260, in launch_agent
    result = agent.run()
             ^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/metrics/api.py", line 137, in wrapper
    result = f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/agent/server/api.py", line 711, in run
    result = self._invoke_run(role)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/agent/server/api.py", line 864, in _invoke_run
    self._initialize_workers(self._worker_group)
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/metrics/api.py", line 137, in wrapper
    result = f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/agent/server/api.py", line 683, in _initialize_workers
    self._rendezvous(worker_group)
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/metrics/api.py", line 137, in wrapper
    result = f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/agent/server/api.py", line 500, in _rendezvous
    rdzv_info = spec.rdzv_handler.next_rendezvous()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/distributed/elastic/rendezvous/static_tcp_rendezvous.py", line 67, in next_rendezvous
    self._store = TCPStore(  # type: ignore[call-arg]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: nonce == returnedNonce INTERNAL ASSERT FAILED at "/pytorch/torch/csrc/distributed/c10d/TCPStore.cpp":405, please report a bug to PyTorch. Ping failed, invalid nonce returned
Traceback (most recent call last):
  File "/opt/conda/bin/llamafactory-cli", line 7, in <module>
    sys.exit(main())
             ^^^^^^
  File "/app/src/llamafactory/cli.py", line 24, in main
    launcher.launch()
  File "/app/src/llamafactory/launcher.py", line 110, in launch
    process = subprocess.run(
              ^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['torchrun', '--nnodes', '2', '--node_rank', '1', '--nproc_per_node', '1', '--master_addr', 'kn140', '--master_port', '32789', '/app/src/llamafactory/launcher.py', '/project/aip-wangcs/indrisch/LLaMA-Factory/examples/train_lora/qwen2_5vl_lora_sft_SQA3Devery24_2node.yaml']' returned non-zero exit status 1.
srun: forcing job termination
srun: Job step aborted: Waiting up to 62 seconds for job step to finish.
slurmstepd: error: *** STEP 1545529.1 ON kn140 CANCELLED AT 2025-12-04T17:35:59 ***
srun: error: kn144: task 1: Killed
srun: error: kn140: task 0: Killed
