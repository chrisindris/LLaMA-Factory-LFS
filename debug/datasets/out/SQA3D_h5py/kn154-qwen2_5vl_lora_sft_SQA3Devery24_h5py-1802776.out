/project/aip-wangcs/indrisch/LLaMA-Factory /project/aip-wangcs/indrisch/LLaMA-Factory/debug/datasets
[INFO|2026-01-07 23:51:51] llamafactory.launcher:143 >> Initializing 4 distributed tasks at: 127.0.0.1:55385
W0107 23:51:54.044000 1314274 torch/distributed/run.py:803] 
W0107 23:51:54.044000 1314274 torch/distributed/run.py:803] *****************************************
W0107 23:51:54.044000 1314274 torch/distributed/run.py:803] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0107 23:51:54.044000 1314274 torch/distributed/run.py:803] *****************************************
[WARNING|2026-01-07 23:52:02] llamafactory.extras.misc:154 >> Version checking has been disabled, may lead to unexpected behaviors.
⚙️  Running in WANDB offline mode
⚙️  Running in WANDB offline mode
⚙️  Running in WANDB offline mode
⚙️  Running in WANDB offline mode
[2026-01-07 23:52:06,850] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2026-01-07 23:52:06,850] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2026-01-07 23:52:06,850] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2026-01-07 23:52:06,850] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to cuda (auto detect)
/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/jieba/_compat.py:18: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/jieba/_compat.py:18: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/jieba/_compat.py:18: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/jieba/_compat.py:18: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
[2026-01-07 23:52:14,014] [INFO] [comm.py:658:init_distributed] cdb=None
[2026-01-07 23:52:14,014] [INFO] [comm.py:658:init_distributed] cdb=None
[2026-01-07 23:52:14,014] [INFO] [comm.py:689:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[2026-01-07 23:52:14,014] [INFO] [comm.py:658:init_distributed] cdb=None
[W107 23:52:14.961761803 ProcessGroupNCCL.cpp:924] Warning: TORCH_NCCL_AVOID_RECORD_STREAMS is the default now, this environment variable is thus deprecated. (function operator())
[W107 23:52:14.961759126 ProcessGroupNCCL.cpp:924] Warning: TORCH_NCCL_AVOID_RECORD_STREAMS is the default now, this environment variable is thus deprecated. (function operator())
[W107 23:52:14.961763818 ProcessGroupNCCL.cpp:924] Warning: TORCH_NCCL_AVOID_RECORD_STREAMS is the default now, this environment variable is thus deprecated. (function operator())
[2026-01-07 23:52:14,038] [INFO] [comm.py:658:init_distributed] cdb=None
[W107 23:52:14.983342672 ProcessGroupNCCL.cpp:924] Warning: TORCH_NCCL_AVOID_RECORD_STREAMS is the default now, this environment variable is thus deprecated. (function operator())
[INFO|2026-01-07 23:52:14] llamafactory.hparams.parser:143 >> Set `ddp_find_unused_parameters` to False in DDP training since LoRA is enabled.
[INFO|2026-01-07 23:52:14] llamafactory.hparams.parser:455 >> Process rank: 3, world size: 4, device: cuda:3, distributed training: True, compute dtype: torch.bfloat16
[INFO|2026-01-07 23:52:14] llamafactory.hparams.parser:455 >> Process rank: 0, world size: 4, device: cuda:0, distributed training: True, compute dtype: torch.bfloat16
[INFO|2026-01-07 23:52:14] llamafactory.hparams.parser:455 >> Process rank: 1, world size: 4, device: cuda:1, distributed training: True, compute dtype: torch.bfloat16
[INFO|2026-01-07 23:52:14] llamafactory.hparams.parser:455 >> Process rank: 2, world size: 4, device: cuda:2, distributed training: True, compute dtype: torch.bfloat16
[INFO|hub.py:421] 2026-01-07 23:52:14,486 >> Offline mode: forcing local_files_only=True
[INFO|tokenization_utils_base.py:1949] 2026-01-07 23:52:14,549 >> Offline mode: forcing local_files_only=True
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:14,564 >> loading file vocab.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/vocab.json
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:14,564 >> loading file merges.txt from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/merges.txt
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:14,564 >> loading file tokenizer.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/tokenizer.json
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:14,564 >> loading file added_tokens.json from cache at None
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:14,564 >> loading file special_tokens_map.json from cache at None
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:14,564 >> loading file tokenizer_config.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/tokenizer_config.json
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:14,564 >> loading file chat_template.jinja from cache at None
[INFO|tokenization_utils_base.py:2364] 2026-01-07 23:52:14,964 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
[INFO|hub.py:421] 2026-01-07 23:52:14,965 >> Offline mode: forcing local_files_only=True
[INFO|hub.py:421] 2026-01-07 23:52:14,966 >> Offline mode: forcing local_files_only=True
[INFO|image_processing_base.py:316] 2026-01-07 23:52:14,967 >> Offline mode: forcing local_files_only=True
[INFO|image_processing_base.py:383] 2026-01-07 23:52:14,970 >> loading configuration file preprocessor_config.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/preprocessor_config.json
[INFO|image_processing_base.py:316] 2026-01-07 23:52:14,979 >> Offline mode: forcing local_files_only=True
[INFO|image_processing_base.py:383] 2026-01-07 23:52:14,981 >> loading configuration file preprocessor_config.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/preprocessor_config.json
[INFO|image_processing_base.py:428] 2026-01-07 23:52:14,999 >> Image processor Qwen2VLImageProcessorFast {
  "crop_size": null,
  "data_format": "channels_first",
  "default_to_square": true,
  "device": null,
  "disable_grouping": null,
  "do_center_crop": null,
  "do_convert_rgb": true,
  "do_normalize": true,
  "do_pad": null,
  "do_rescale": true,
  "do_resize": true,
  "image_mean": [
    0.48145466,
    0.4578275,
    0.40821073
  ],
  "image_processor_type": "Qwen2VLImageProcessorFast",
  "image_std": [
    0.26862954,
    0.26130258,
    0.27577711
  ],
  "input_data_format": null,
  "max_pixels": 12845056,
  "merge_size": 2,
  "min_pixels": 3136,
  "pad_size": null,
  "patch_size": 14,
  "processor_class": "Qwen2_5_VLProcessor",
  "resample": 3,
  "rescale_factor": 0.00392156862745098,
  "return_tensors": null,
  "size": {
    "longest_edge": 12845056,
    "shortest_edge": 3136
  },
  "temporal_patch_size": 2
}

[INFO|tokenization_utils_base.py:1949] 2026-01-07 23:52:15,999 >> Offline mode: forcing local_files_only=True
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:15,005 >> loading file vocab.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/vocab.json
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:15,005 >> loading file merges.txt from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/merges.txt
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:15,005 >> loading file tokenizer.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/tokenizer.json
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:15,005 >> loading file added_tokens.json from cache at None
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:15,005 >> loading file special_tokens_map.json from cache at None
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:15,005 >> loading file tokenizer_config.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/tokenizer_config.json
[INFO|tokenization_utils_base.py:2095] 2026-01-07 23:52:15,005 >> loading file chat_template.jinja from cache at None
[INFO|tokenization_utils_base.py:2364] 2026-01-07 23:52:15,273 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
[INFO|video_processing_utils.py:660] 2026-01-07 23:52:15,275 >> Offline mode: forcing local_files_only=True
[INFO|video_processing_utils.py:726] 2026-01-07 23:52:15,278 >> loading configuration file video_preprocessor_config.json from cache at /scratch/indrisch/huggingface/hub/models--Qwen--Qwen2.5-VL-7B-Instruct/snapshots/cc594898137f460bfe9f0759e9844b3ce807cfb5/preprocessor_config.json
[INFO|video_processing_utils.py:770] 2026-01-07 23:52:15,287 >> Video processor Qwen2VLVideoProcessor {
  "crop_size": null,
  "data_format": "channels_first",
  "default_to_square": true,
  "device": null,
  "do_center_crop": null,
  "do_convert_rgb": true,
  "do_normalize": true,
  "do_rescale": true,
  "do_resize": true,
  "do_sample_frames": false,
  "fps": null,
  "image_mean": [
    0.48145466,
    0.4578275,
    0.40821073
  ],
  "image_std": [
    0.26862954,
    0.26130258,
    0.27577711
  ],
  "input_data_format": null,
  "max_frames": 768,
  "max_pixels": 12845056,
  "merge_size": 2,
  "min_frames": 4,
  "min_pixels": 3136,
  "num_frames": null,
  "pad_size": null,
  "patch_size": 14,
  "processor_class": "Qwen2_5_VLProcessor",
  "resample": 3,
  "rescale_factor": 0.00392156862745098,
  "return_metadata": false,
  "size": {
    "longest_edge": 12845056,
    "shortest_edge": 3136
  },
  "temporal_patch_size": 2,
  "video_metadata": null,
  "video_processor_type": "Qwen2VLVideoProcessor"
}

[INFO|processing_utils.py:928] 2026-01-07 23:52:15,287 >> Offline mode: forcing local_files_only=True
[INFO|processing_utils.py:1116] 2026-01-07 23:52:15,294 >> loading configuration file processor_config.json from cache at None
[INFO|processing_utils.py:1199] 2026-01-07 23:52:15,743 >> Processor Qwen2_5_VLProcessor:
- image_processor: Qwen2VLImageProcessorFast {
  "crop_size": null,
  "data_format": "channels_first",
  "default_to_square": true,
  "device": null,
  "disable_grouping": null,
  "do_center_crop": null,
  "do_convert_rgb": true,
  "do_normalize": true,
  "do_pad": null,
  "do_rescale": true,
  "do_resize": true,
  "image_mean": [
    0.48145466,
    0.4578275,
    0.40821073
  ],
  "image_processor_type": "Qwen2VLImageProcessorFast",
  "image_std": [
    0.26862954,
    0.26130258,
    0.27577711
  ],
  "input_data_format": null,
  "max_pixels": 12845056,
  "merge_size": 2,
  "min_pixels": 3136,
  "pad_size": null,
  "patch_size": 14,
  "processor_class": "Qwen2_5_VLProcessor",
  "resample": 3,
  "rescale_factor": 0.00392156862745098,
  "return_tensors": null,
  "size": {
    "longest_edge": 12845056,
    "shortest_edge": 3136
  },
  "temporal_patch_size": 2
}

- tokenizer: Qwen2TokenizerFast(name_or_path='Qwen/Qwen2.5-VL-7B-Instruct', vocab_size=151643, model_max_length=131072, is_fast=True, padding_side='right', truncation_side='right', special_tokens={'eos_token': '<|im_end|>', 'pad_token': '<|endoftext|>', 'additional_special_tokens': ['<|im_start|>', '<|im_end|>', '<|object_ref_start|>', '<|object_ref_end|>', '<|box_start|>', '<|box_end|>', '<|quad_start|>', '<|quad_end|>', '<|vision_start|>', '<|vision_end|>', '<|vision_pad|>', '<|image_pad|>', '<|video_pad|>']}, clean_up_tokenization_spaces=False, added_tokens_decoder={
	151643: AddedToken("<|endoftext|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151644: AddedToken("<|im_start|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151645: AddedToken("<|im_end|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151646: AddedToken("<|object_ref_start|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151647: AddedToken("<|object_ref_end|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151648: AddedToken("<|box_start|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151649: AddedToken("<|box_end|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151650: AddedToken("<|quad_start|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151651: AddedToken("<|quad_end|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151652: AddedToken("<|vision_start|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151653: AddedToken("<|vision_end|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151654: AddedToken("<|vision_pad|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151655: AddedToken("<|image_pad|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151656: AddedToken("<|video_pad|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),
	151657: AddedToken("<tool_call>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=False),
	151658: AddedToken("</tool_call>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=False),
	151659: AddedToken("<|fim_prefix|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=False),
	151660: AddedToken("<|fim_middle|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=False),
	151661: AddedToken("<|fim_suffix|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=False),
	151662: AddedToken("<|fim_pad|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=False),
	151663: AddedToken("<|repo_name|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=False),
	151664: AddedToken("<|file_sep|>", rstrip=False, lstrip=False, single_word=False, normalized=False, special=False),
}
)
- video_processor: Qwen2VLVideoProcessor {
  "crop_size": null,
  "data_format": "channels_first",
  "default_to_square": true,
  "device": null,
  "do_center_crop": null,
  "do_convert_rgb": true,
  "do_normalize": true,
  "do_rescale": true,
  "do_resize": true,
  "do_sample_frames": false,
  "fps": null,
  "image_mean": [
    0.48145466,
    0.4578275,
    0.40821073
  ],
  "image_std": [
    0.26862954,
    0.26130258,
    0.27577711
  ],
  "input_data_format": null,
  "max_frames": 768,
  "max_pixels": 12845056,
  "merge_size": 2,
  "min_frames": 4,
  "min_pixels": 3136,
  "num_frames": null,
  "pad_size": null,
  "patch_size": 14,
  "processor_class": "Qwen2_5_VLProcessor",
  "resample": 3,
  "rescale_factor": 0.00392156862745098,
  "return_metadata": false,
  "size": {
    "longest_edge": 12845056,
    "shortest_edge": 3136
  },
  "temporal_patch_size": 2,
  "video_metadata": null,
  "video_processor_type": "Qwen2VLVideoProcessor"
}


{
  "processor_class": "Qwen2_5_VLProcessor"
}

[INFO|2026-01-07 23:52:15] llamafactory.data.loader:143 >> Loading dataset /scratch/indrisch/huggingface/hub/datasets--cvis-tmu--llamafactory-sqa3d-traces-multiimage-vqa/snapshots/ce5c54adc1608d1726730c9ff334e65b6dd70e46/data/...
`trust_remote_code` is not supported anymore.
Please check that the Hugging Face dataset 'parquet' isn't based on a loading script and remove `trust_remote_code`.
If the dataset is based on a loading script, please ask the dataset author to remove it and convert it to a standard format like Parquet.
Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s][WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0542_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0207_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0554_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0610_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0567_00/color/0.jpg does not exist in `media_dir`. Use original path.
Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s][WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0403_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0236_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0564_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0065_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0564_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0232_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0246_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0115_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0022_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0307_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0613_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0156_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0323_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0189_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0670_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0194_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0426_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0548_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0292_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0355_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0398_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0330_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0480_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0353_00/color/0.jpg does not exist in `media_dir`. Use original path.
[WARNING|2026-01-07 23:52:16] llamafactory.data.converter:154 >> Media /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0309_00/color/0.jpg does not exist in `media_dir`. Use original path.
Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s]
/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/torch/distributed/distributed_c10d.py:4876: UserWarning: barrier(): using the device under current context. You can specify `device_id` in `init_process_group` to mute this warning.
  warnings.warn(  # warn only once
[rank0]:[W107 23:52:17.982437611 ProcessGroupNCCL.cpp:5072] Guessing device ID based on global rank. This can cause a hang if rank to GPU mapping is heterogeneous. You can specify device_id in init_process_group()
`trust_remote_code` is not supported anymore.
Please check that the Hugging Face dataset 'parquet' isn't based on a loading script and remove `trust_remote_code`.
If the dataset is based on a loading script, please ask the dataset author to remove it and convert it to a standard format like Parquet.
`trust_remote_code` is not supported anymore.
Please check that the Hugging Face dataset 'parquet' isn't based on a loading script and remove `trust_remote_code`.
If the dataset is based on a loading script, please ask the dataset author to remove it and convert it to a standard format like Parquet.
`trust_remote_code` is not supported anymore.
Please check that the Hugging Face dataset 'parquet' isn't based on a loading script and remove `trust_remote_code`.
If the dataset is based on a loading script, please ask the dataset author to remove it and convert it to a standard format like Parquet.
[rank0]: multiprocess.pool.RemoteTraceback: 
[rank0]: """
[rank0]: Traceback (most recent call last):
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 62, in _find_medias
[rank0]:     image = retrieve_image(image_path=media_path)
[rank0]:             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]: TypeError: retrieve_image() got an unexpected keyword argument 'image_path'

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/multiprocess/pool.py", line 125, in worker
[rank0]:     result = (True, func(*args, **kwds))
[rank0]:                     ^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 586, in _write_generator_to_queue
[rank0]:     for i, result in enumerate(func(**kwargs)):
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3650, in _map_single
[rank0]:     for i, example in iter_outputs(shard_iterable):
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3624, in iter_outputs
[rank0]:     yield i, apply_function(example, i, offset=offset)
[rank0]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3547, in apply_function
[rank0]:     processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
[rank0]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 136, in __call__
[rank0]:     "_images": self._find_medias(example[self.dataset_attr.images]) if self.dataset_attr.images else None,
[rank0]:                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 68, in _find_medias
[rank0]:     raise ValueError(f"Failed to retrieve image from {media_path}: {e}")
[rank0]: ValueError: Failed to retrieve image from /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg: retrieve_image() got an unexpected keyword argument 'image_path'
[rank0]: """

[rank0]: The above exception was the direct cause of the following exception:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/launcher.py", line 184, in <module>
[rank0]:     run_exp()
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/tuner.py", line 122, in run_exp
[rank0]:     _training_function(config={"args": args, "callbacks": callbacks})
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/tuner.py", line 84, in _training_function
[rank0]:     run_sft(model_args, data_args, training_args, finetuning_args, generating_args, callbacks)
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/sft/workflow.py", line 51, in run_sft
[rank0]:     dataset_module = get_dataset(template, model_args, data_args, training_args, stage="sft", **tokenizer_module)
[rank0]:                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 305, in get_dataset
[rank0]:     dataset = _get_merged_dataset(data_args.dataset, model_args, data_args, training_args, stage)
[rank0]:               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 183, in _get_merged_dataset
[rank0]:     datasets[dataset_name] = _load_single_dataset(dataset_attr, model_args, data_args, training_args)
[rank0]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 163, in _load_single_dataset
[rank0]:     return align_dataset(dataset, dataset_attr, data_args, training_args)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 429, in align_dataset
[rank0]:     return dataset.map(
[rank0]:            ^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 560, in wrapper
[rank0]:     out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
[rank0]:                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3309, in map
[rank0]:     for rank, done, content in iflatmap_unordered(
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 626, in iflatmap_unordered
[rank0]:     [async_result.get(timeout=0.05) for async_result in async_results]
[rank0]:      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/multiprocess/pool.py", line 774, in get
[rank0]:     raise self._value
[rank0]: ValueError: Failed to retrieve image from /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg: retrieve_image() got an unexpected keyword argument 'image_path'
Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s]Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s]Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s][rank0]:[W107 23:52:18.129999676 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s]Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s]Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s]Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:00<?, ? examples/s]Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:01<?, ? examples/s]Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:01<?, ? examples/s]
[rank2]: multiprocess.pool.RemoteTraceback: 
[rank2]: """
[rank2]: Traceback (most recent call last):
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 62, in _find_medias
[rank2]:     image = retrieve_image(image_path=media_path)
[rank2]:             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]: TypeError: retrieve_image() got an unexpected keyword argument 'image_path'

[rank2]: During handling of the above exception, another exception occurred:

[rank2]: Traceback (most recent call last):
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/multiprocess/pool.py", line 125, in worker
[rank2]:     result = (True, func(*args, **kwds))
[rank2]:                     ^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 586, in _write_generator_to_queue
[rank2]:     for i, result in enumerate(func(**kwargs)):
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3650, in _map_single
[rank2]:     for i, example in iter_outputs(shard_iterable):
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3624, in iter_outputs
[rank2]:     yield i, apply_function(example, i, offset=offset)
[rank2]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3547, in apply_function
[rank2]:     processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
[rank2]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 136, in __call__
[rank2]:     "_images": self._find_medias(example[self.dataset_attr.images]) if self.dataset_attr.images else None,
[rank2]:                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 68, in _find_medias
[rank2]:     raise ValueError(f"Failed to retrieve image from {media_path}: {e}")
[rank2]: ValueError: Failed to retrieve image from /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg: retrieve_image() got an unexpected keyword argument 'image_path'
[rank2]: """

[rank2]: The above exception was the direct cause of the following exception:

[rank2]: Traceback (most recent call last):
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/launcher.py", line 184, in <module>
[rank2]:     run_exp()
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/tuner.py", line 122, in run_exp
[rank2]:     _training_function(config={"args": args, "callbacks": callbacks})
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/tuner.py", line 84, in _training_function
[rank2]:     run_sft(model_args, data_args, training_args, finetuning_args, generating_args, callbacks)
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/sft/workflow.py", line 51, in run_sft
[rank2]:     dataset_module = get_dataset(template, model_args, data_args, training_args, stage="sft", **tokenizer_module)
[rank2]:                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 305, in get_dataset
[rank2]:     dataset = _get_merged_dataset(data_args.dataset, model_args, data_args, training_args, stage)
[rank2]:               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 183, in _get_merged_dataset
[rank2]:     datasets[dataset_name] = _load_single_dataset(dataset_attr, model_args, data_args, training_args)
[rank2]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 163, in _load_single_dataset
[rank2]:     return align_dataset(dataset, dataset_attr, data_args, training_args)
[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 429, in align_dataset
[rank2]:     return dataset.map(
[rank2]:            ^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 560, in wrapper
[rank2]:     out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
[rank2]:                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3309, in map
[rank2]:     for rank, done, content in iflatmap_unordered(
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 626, in iflatmap_unordered
[rank2]:     [async_result.get(timeout=0.05) for async_result in async_results]
[rank2]:      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/multiprocess/pool.py", line 774, in get
[rank2]:     raise self._value
[rank2]: ValueError: Failed to retrieve image from /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg: retrieve_image() got an unexpected keyword argument 'image_path'
Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:01<?, ? examples/s]
[rank3]: multiprocess.pool.RemoteTraceback: 
[rank3]: """
[rank3]: Traceback (most recent call last):
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 62, in _find_medias
[rank3]:     image = retrieve_image(image_path=media_path)
[rank3]:             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]: TypeError: retrieve_image() got an unexpected keyword argument 'image_path'

[rank3]: During handling of the above exception, another exception occurred:

[rank3]: Traceback (most recent call last):
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/multiprocess/pool.py", line 125, in worker
[rank3]:     result = (True, func(*args, **kwds))
[rank3]:                     ^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 586, in _write_generator_to_queue
[rank3]:     for i, result in enumerate(func(**kwargs)):
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3650, in _map_single
[rank3]:     for i, example in iter_outputs(shard_iterable):
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3624, in iter_outputs
[rank3]:     yield i, apply_function(example, i, offset=offset)
[rank3]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3547, in apply_function
[rank3]:     processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
[rank3]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 136, in __call__
[rank3]:     "_images": self._find_medias(example[self.dataset_attr.images]) if self.dataset_attr.images else None,
[rank3]:                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 68, in _find_medias
[rank3]:     raise ValueError(f"Failed to retrieve image from {media_path}: {e}")
[rank3]: ValueError: Failed to retrieve image from /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg: retrieve_image() got an unexpected keyword argument 'image_path'
[rank3]: """

[rank3]: The above exception was the direct cause of the following exception:

[rank3]: Traceback (most recent call last):
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/launcher.py", line 184, in <module>
[rank3]:     run_exp()
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/tuner.py", line 122, in run_exp
[rank3]:     _training_function(config={"args": args, "callbacks": callbacks})
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/tuner.py", line 84, in _training_function
[rank3]:     run_sft(model_args, data_args, training_args, finetuning_args, generating_args, callbacks)
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/sft/workflow.py", line 51, in run_sft
[rank3]:     dataset_module = get_dataset(template, model_args, data_args, training_args, stage="sft", **tokenizer_module)
[rank3]:                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 305, in get_dataset
[rank3]:     dataset = _get_merged_dataset(data_args.dataset, model_args, data_args, training_args, stage)
[rank3]:               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 183, in _get_merged_dataset
[rank3]:     datasets[dataset_name] = _load_single_dataset(dataset_attr, model_args, data_args, training_args)
[rank3]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 163, in _load_single_dataset
[rank3]:     return align_dataset(dataset, dataset_attr, data_args, training_args)
[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 429, in align_dataset
[rank3]:     return dataset.map(
[rank3]:            ^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 560, in wrapper
[rank3]:     out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
[rank3]:                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3309, in map
[rank3]:     for rank, done, content in iflatmap_unordered(
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 626, in iflatmap_unordered
[rank3]:     [async_result.get(timeout=0.05) for async_result in async_results]
[rank3]:      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/multiprocess/pool.py", line 774, in get
[rank3]:     raise self._value
[rank3]: ValueError: Failed to retrieve image from /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg: retrieve_image() got an unexpected keyword argument 'image_path'
Converting format of dataset (num_proc=32):   0%|          | 0/100 [00:01<?, ? examples/s]
[rank1]: multiprocess.pool.RemoteTraceback: 
[rank1]: """
[rank1]: Traceback (most recent call last):
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 62, in _find_medias
[rank1]:     image = retrieve_image(image_path=media_path)
[rank1]:             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]: TypeError: retrieve_image() got an unexpected keyword argument 'image_path'

[rank1]: During handling of the above exception, another exception occurred:

[rank1]: Traceback (most recent call last):
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/multiprocess/pool.py", line 125, in worker
[rank1]:     result = (True, func(*args, **kwds))
[rank1]:                     ^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 586, in _write_generator_to_queue
[rank1]:     for i, result in enumerate(func(**kwargs)):
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3650, in _map_single
[rank1]:     for i, example in iter_outputs(shard_iterable):
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3624, in iter_outputs
[rank1]:     yield i, apply_function(example, i, offset=offset)
[rank1]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3547, in apply_function
[rank1]:     processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
[rank1]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 136, in __call__
[rank1]:     "_images": self._find_medias(example[self.dataset_attr.images]) if self.dataset_attr.images else None,
[rank1]:                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 68, in _find_medias
[rank1]:     raise ValueError(f"Failed to retrieve image from {media_path}: {e}")
[rank1]: ValueError: Failed to retrieve image from /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg: retrieve_image() got an unexpected keyword argument 'image_path'
[rank1]: """

[rank1]: The above exception was the direct cause of the following exception:

[rank1]: Traceback (most recent call last):
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/launcher.py", line 184, in <module>
[rank1]:     run_exp()
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/tuner.py", line 122, in run_exp
[rank1]:     _training_function(config={"args": args, "callbacks": callbacks})
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/tuner.py", line 84, in _training_function
[rank1]:     run_sft(model_args, data_args, training_args, finetuning_args, generating_args, callbacks)
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/train/sft/workflow.py", line 51, in run_sft
[rank1]:     dataset_module = get_dataset(template, model_args, data_args, training_args, stage="sft", **tokenizer_module)
[rank1]:                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 305, in get_dataset
[rank1]:     dataset = _get_merged_dataset(data_args.dataset, model_args, data_args, training_args, stage)
[rank1]:               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 183, in _get_merged_dataset
[rank1]:     datasets[dataset_name] = _load_single_dataset(dataset_attr, model_args, data_args, training_args)
[rank1]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/loader.py", line 163, in _load_single_dataset
[rank1]:     return align_dataset(dataset, dataset_attr, data_args, training_args)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/data/converter.py", line 429, in align_dataset
[rank1]:     return dataset.map(
[rank1]:            ^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 560, in wrapper
[rank1]:     out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
[rank1]:                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3309, in map
[rank1]:     for rank, done, content in iflatmap_unordered(
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 626, in iflatmap_unordered
[rank1]:     [async_result.get(timeout=0.05) for async_result in async_results]
[rank1]:      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/multiprocess/pool.py", line 774, in get
[rank1]:     raise self._value
[rank1]: ValueError: Failed to retrieve image from /project/aip-wangcs/shared/data_h5py/ScanNet/scans/scene0119_00/color/0.jpg: retrieve_image() got an unexpected keyword argument 'image_path'
[rank0]:[W107 23:52:19.395583334 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
W0107 23:52:20.283000 1314274 torch/distributed/elastic/multiprocessing/api.py:908] Sending process 1314278 closing signal SIGTERM
W0107 23:52:20.287000 1314274 torch/distributed/elastic/multiprocessing/api.py:908] Sending process 1314279 closing signal SIGTERM
W0107 23:52:20.290000 1314274 torch/distributed/elastic/multiprocessing/api.py:908] Sending process 1314280 closing signal SIGTERM
E0107 23:52:20.607000 1314274 torch/distributed/elastic/multiprocessing/api.py:882] failed (exitcode: 1) local_rank: 0 (pid: 1314277) of binary: /project/6110552/indrisch/venv_llamafactory_cu126/bin/python
Traceback (most recent call last):
  File "/project/6110552/indrisch/venv_llamafactory_cu126/bin/torchrun", line 7, in <module>
    sys.exit(main())
             ^^^^^^
  File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/torch/distributed/run.py", line 936, in main
    run(args)
  File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/torch/distributed/run.py", line 927, in run
    elastic_launch(
  File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/torch/distributed/launcher/api.py", line 156, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/6110552/indrisch/venv_llamafactory_cu126/lib/python3.12/site-packages/torch/distributed/launcher/api.py", line 293, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/launcher.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2026-01-07_23:52:20
  host      : kn154.paice.vectorinstitute.ai
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 1314277)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
[W107 23:52:20.753376261 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
Traceback (most recent call last):
  File "/project/6110552/indrisch/venv_llamafactory_cu126/bin/llamafactory-cli", line 7, in <module>
    sys.exit(main())
             ^^^^^^
  File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/cli.py", line 24, in main
    launcher.launch()
  File "/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/launcher.py", line 114, in launch
    process = subprocess.run(
              ^^^^^^^^^^^^^^^
  File "/cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v3/Compiler/gcccore/python/3.12.4/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['torchrun', '--nnodes', '1', '--node_rank', '0', '--nproc_per_node', '4', '--master_addr', '127.0.0.1', '--master_port', '55385', '/project/6110552/indrisch/LLaMA-Factory/src/llamafactory/launcher.py', '/project/aip-wangcs/indrisch/LLaMA-Factory/examples/train_lora/qwen2_5vl_lora_sft_SQA3Devery24_h5py.yaml']' returned non-zero exit status 1.
[W107 23:52:21.448478703 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
